<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Implementing multi-column sorting functionality with custom comparators for complex Star Wars data types and server-side sort integration" />
    <link rel="shortcut icon" href="/assets/ico/favicon.ico" />
    <title>Galactic Archives - Adding Sorting</title>
    <link rel="stylesheet" href="/assets/css/tufte.min.css" />
    <link rel="stylesheet" href="/assets/css/prism-theme.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />
    <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="Aaron T. Maturen's Musings" />
  </head>
  <body>
    <article>

<nav class="tw-breadcrumbs" aria-label="Breadcrumbs">
  <ol>
    <li>
      <a href="/" aria-label="Home">Home</a>
    </li>
        <li>
            <a href="/musings">Musings</a>
        </li>
        <li>
            <span aria-current="page">Post 9 adding sorting</span>
        </li>
  </ol>
</nav>
        
<header>
  <h1>Galactic Archives - Adding Sorting</h1>
  <p class="subtitle">June 9, 2025</p>
  
  <p class="code-links">
    <a href="https://github.com/aaronmaturen/galactic-archives/tree/post-9" target="_blank" rel="noopener">View on GitHub</a> | 
    <a href="https://stackblitz.com/fork/github/aaronmaturen/galactic-archives/tree/post-9" target="_blank" rel="noopener">Run on StackBlitz</a>
  </p>
</header>

<main>
  <article>
    <h1>Angular DataSource with SWAPI: Building the Galactic Archives - Adding Sorting Capabilities</h1>
<p><em>In the vast expanse of the Galactic Archives, chaos reigns when data lacks order. As any seasoned Imperial data analyst knows, the difference between finding a specific Jedi's record in seconds versus hours comes down to one critical feature: sorting. Today, we'll bring order to our galaxy of data.</em></p>
<h2>The Unsorted Galaxy Problem</h2>
<p>Our Galactic Archives have come a long way. We've implemented a robust DataSource pattern and added pagination to navigate through our vast collection of character records. But our users—primarily Imperial officers with tight schedules and low patience—have been filing complaints faster than stormtroopers miss blaster shots:</p>
<p>&quot;How am I supposed to find the tallest potential recruits?&quot;
&quot;Can I sort by birth year to identify the most experienced operatives?&quot;
&quot;Why can't I organize these rebels alphabetically for my wanted posters?&quot;</p>
<p>Without sorting capabilities, our otherwise impressive data table is like a library where books are shelved in the order they were published—technically functional but practically maddening.</p>
<blockquote>
<p>The Cosmic Compiler once reviewed an unsorted data table and simply printed: &quot;A table without sorting is like a starship without navigation—you have the power to travel, but no control over your destination.&quot; The junior developer responsible was found the next day, still staring blankly at their monitor, muttering about &quot;natural ordering&quot; and &quot;comparative algorithms.&quot;</p>
</blockquote>
<h2>Enter MatSort: The Imperial Organizer</h2>
<p>Angular Material's <code>MatSort</code> directive is our answer to this organizational chaos. It provides a standardized way to add sorting capabilities to tables with minimal effort. Think of it as the Imperial bureaucracy of data organization—rigid, efficient, and surprisingly effective when implemented correctly.</p>
<p>Let's start by updating our component imports to include the necessary sorting modules:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/features/star-wars/components/character-list/character-list.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Component<span class="token punctuation">,</span>
  OnInit<span class="token punctuation">,</span>
  OnDestroy<span class="token punctuation">,</span>
  ViewChild<span class="token punctuation">,</span>
  AfterViewInit<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/core"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/common"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatTableModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/material/table"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatProgressSpinnerModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/material/progress-spinner"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatPaginatorModule<span class="token punctuation">,</span> MatPaginator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/material/paginator"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatSortModule<span class="token punctuation">,</span> MatSort <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/material/sort"</span><span class="token punctuation">;</span> <span class="token comment">// Add this import</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatIconModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@angular/material/icon"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StarWarsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../../../../core/services/star-wars.service"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GalacticDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../../datasources/galactic.datasource"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Character <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../../../../core/models/character.interface"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"rxjs"</span><span class="token punctuation">;</span></code></pre>
<p>Notice we've added <code>MatSortModule</code> and <code>MatSort</code> to our imports. The module provides the directives needed for sorting, while the <code>MatSort</code> class gives us a reference to the sorting state.</p>
<p>Next, we need to update our component's metadata to include the new module:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-character-list'</span><span class="token punctuation">,</span>
  standalone<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CommonModule<span class="token punctuation">,</span>
    MatTableModule<span class="token punctuation">,</span>
    MatProgressSpinnerModule<span class="token punctuation">,</span>
    MatPaginatorModule<span class="token punctuation">,</span>
    MatSortModule<span class="token punctuation">,</span> <span class="token comment">// Add this import</span>
    MatIconModule
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ... template and styles</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Now, let's add a <code>ViewChild</code> reference to capture the <code>MatSort</code> instance from our template:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CharacterListComponent</span>
  <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewInit<span class="token punctuation">,</span> OnDestroy
<span class="token punctuation">{</span>
  <span class="token comment">// Existing properties...</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ViewChild</span></span><span class="token punctuation">(</span>MatPaginator<span class="token punctuation">)</span> paginator<span class="token operator">!</span><span class="token operator">:</span> MatPaginator<span class="token punctuation">;</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ViewChild</span></span><span class="token punctuation">(</span>MatSort<span class="token punctuation">)</span> sort<span class="token operator">!</span><span class="token operator">:</span> MatSort<span class="token punctuation">;</span> <span class="token comment">// Add this line</span>

  <span class="token comment">// Rest of the component...</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>The Ancient Order of Angular teaches that the <code>!</code> operator is not just a TypeScript non-null assertion but a solemn promise to the compiler that you, the developer, take full responsibility for any runtime null reference exceptions. &quot;Use it wisely,&quot; they warn, &quot;for with great assertion comes great debugging responsibility.&quot;</p>
</blockquote>
<h2>Updating the Template</h2>
<p>Now we need to update our template to include the sorting directives. This involves two key changes:</p>
<ol>
<li>Adding the <code>matSort</code> directive to the table element</li>
<li>Adding <code>mat-sort-header</code> to each column header we want to be sortable</li>
</ol>
<p>Here's how we update our table element:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">mat-table</span> <span class="token attr-name">[dataSource]</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">matSort</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-w-full<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span></code></pre>
<p>The <code>matSort</code> directive tells Angular Material that this table should support sorting. Next, we need to update each column header that we want to be sortable. Let's modify our name column as an example:</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- Name Column --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span>
    <span class="token attr-name">mat-header-cell</span>
    <span class="token attr-name">*matHeaderCellDef</span>
    <span class="token attr-name">mat-sort-header</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-text-yellow-400<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-flex tw-items-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-mr-1 tw-text-base tw-text-yellow-400<span class="token punctuation">"</span></span>
        <span class="token punctuation">></span></span>person<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span>
      <span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>NAME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span>
    <span class="token attr-name">mat-cell</span>
    <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let character<span class="token punctuation">"</span></span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-text-yellow-400 tw-font-medium<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span>
    {{ character.name }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">></span></span></code></pre>
<p>Notice the addition of <code>mat-sort-header</code> to the <code>th</code> element. This transforms our plain header into a clickable sorting control. Let's do the same for our other columns:</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- Gender Column --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span>
    <span class="token attr-name">mat-header-cell</span>
    <span class="token attr-name">*matHeaderCellDef</span>
    <span class="token attr-name">mat-sort-header</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-text-yellow-400<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-flex tw-items-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-mr-1 tw-text-base tw-text-yellow-400<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>wc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>GENDER<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let character<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ character.gender }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- Birth Year Column --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>birth_year<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span>
    <span class="token attr-name">mat-header-cell</span>
    <span class="token attr-name">*matHeaderCellDef</span>
    <span class="token attr-name">mat-sort-header</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-text-yellow-400<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-flex tw-items-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-mr-1 tw-text-base tw-text-yellow-400<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>cake<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>BIRTH YEAR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let character<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ character.birth_year }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- Height Column --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ng-container</span> <span class="token attr-name">matColumnDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span>
    <span class="token attr-name">mat-header-cell</span>
    <span class="token attr-name">*matHeaderCellDef</span>
    <span class="token attr-name">mat-sort-header</span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-text-yellow-400<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-flex tw-items-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mat-icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tw-mr-1 tw-text-base tw-text-yellow-400<span class="token punctuation">"</span></span>
        <span class="token punctuation">></span></span>height<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mat-icon</span>
      <span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>HEIGHT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">mat-cell</span> <span class="token attr-name">*matCellDef</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>let character<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ character.height }}cm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ng-container</span><span class="token punctuation">></span></span></code></pre>
<blockquote>
<p>A member of the Council of Patterns once remarked, &quot;The beauty of declarative templates is that they hide the complexity of event binding and state management behind simple directives.&quot; Another council member replied, &quot;Yes, until you need to debug them.&quot; The room fell silent as the Cosmic Compiler nodded in solemn agreement.</p>
</blockquote>
<p>With these changes, our table headers now display sorting indicators and respond to clicks. But clicking them doesn't actually sort our data yet - we need to connect the sorting events to our DataSource.</p>
<h2>Connecting Sort Events to the DataSource</h2>
<p>Now we need to update our component's <code>ngAfterViewInit</code> method to listen for sort events and trigger data reloading when they occur. We'll also need to reset pagination when sorting changes, as users typically expect to see the first page of newly sorted data.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// Connect paginator and sort to our datasource after view init</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paginator <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Reset to first page when sort changes</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">.</span>sortChange<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>pageIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Merge sort and paginator events to reload data</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">.</span>sortChange<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
          <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadCharacters</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>pageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">.</span>active<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sort<span class="token punctuation">.</span>direction
          <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This code does two important things:</p>
<ol>
<li>It resets the paginator to the first page whenever sorting changes</li>
<li>It merges the sort and paginator events into a single stream that triggers data loading</li>
</ol>
<p>The <code>merge</code> operator from RxJS combines multiple observables into one, so we can react to either sort or paginate events with the same logic. The <code>tap</code> operator lets us execute a side effect (loading data) without affecting the stream.</p>
<p>We've also updated our <code>loadCharacters</code> method to pass the sort information to our DataSource:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token function">loadCharacters</span><span class="token punctuation">(</span>
  page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  pageSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span>
  sortField<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  sortDirection<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Update the page size if it changed</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> pageSize<span class="token punctuation">;</span>
    <span class="token comment">// Let the DataSource handle loading the data with sort parameters</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span><span class="token function">loadCharacters</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> sortField<span class="token punctuation">,</span> sortDirection<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to load characters: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">?</span> error<span class="token punctuation">.</span>message <span class="token operator">:</span> <span class="token string">'Unknown error'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. The Cosmic Compiler is displeased.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>We've updated the method to extract the active sort column and direction from our <code>MatSort</code> instance, then pass those values to the DataSource.</p>
<blockquote>
<p>The Recursive Philosopher once pondered, &quot;If a sort event triggers in a component, but no DataSource is listening, does it make a sound?&quot; After three days of contemplation, they concluded: &quot;No, but it does generate 17 console warnings about unhandled events.&quot;</p>
</blockquote>
<h2>Updating the DataSource</h2>
<p>Now comes the most important part: updating our <code>GalacticDataSource</code> to handle sorting. We need to modify the <code>loadCharacters</code> method to accept sort parameters and implement a custom sorting function.</p>
<p>First, let's update the method signature and implementation:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/features/star-wars/datasources/galactic-datasource.ts</span>
<span class="token comment">/**
 * Load characters from the API with pagination and sorting
 * @param page The page number to load (1-based for SWAPI)
 * @param sortField The field to sort by
 * @param sortDirection The direction to sort ('asc' or 'desc')
 * @param pageSize The number of items per page
 */</span>
<span class="token function">loadCharacters</span><span class="token punctuation">(</span>
  page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  sortField<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  sortDirection<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  pageSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span>value
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Update sort state</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sortField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sortSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> active<span class="token operator">:</span> sortField<span class="token punctuation">,</span> direction<span class="token operator">:</span> sortDirection <span class="token keyword">as</span> <span class="token string">'asc'</span> <span class="token operator">|</span> <span class="token string">'desc'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Log the request parameters for debugging</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Loading characters: page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, pageSize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, sort=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sortField<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, direction=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sortDirection<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Clear current data when loading new page</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>starWarsService
    <span class="token punctuation">.</span><span class="token function">getCharacters</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> subscription <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> response <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// Get character data from response</span>
      <span class="token keyword">const</span> characters <span class="token operator">=</span> response<span class="token punctuation">.</span>results
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=></span> item<span class="token punctuation">.</span>properties<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token operator">:</span> char <span class="token keyword">is</span> Character <span class="token operator">=></span> char <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Apply client-side sorting if needed</span>
      <span class="token keyword">const</span> sortedCharacters <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">applySorting</span><span class="token punctuation">(</span>characters<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Update our subjects with the new data</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>sortedCharacters<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>total_records<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> error <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error loading characters:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Keep the current page and page size values to allow retry</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add to our subscription for cleanup</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subscription<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>The key change here is that we're now accepting <code>sortField</code> and <code>sortDirection</code> parameters, and applying client-side sorting to the data after we receive it from the API. This is necessary because the SWAPI doesn't support server-side sorting.</p>
<p>Next, we need to implement the <code>sortData</code> method that will handle the actual sorting logic:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">/**
 * Apply sorting to the character data
 * @param characters The array of characters to sort
 * @returns The sorted array
 */</span>
<span class="token keyword">private</span> <span class="token function">applySorting</span><span class="token punctuation">(</span>characters<span class="token operator">:</span> Character<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Character<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sort <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sortSubject<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sort <span class="token operator">||</span> <span class="token operator">!</span>sort<span class="token punctuation">.</span>active <span class="token operator">||</span> <span class="token operator">!</span>sort<span class="token punctuation">.</span>direction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> characters<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>characters<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sortField <span class="token operator">=</span> sort<span class="token punctuation">.</span>active<span class="token punctuation">;</span>
    <span class="token keyword">const</span> sortDirection <span class="token operator">=</span> sort<span class="token punctuation">.</span>direction <span class="token operator">===</span> <span class="token string">'asc'</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">// Handle nested properties (not needed for current model but included for extensibility)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getPropertyValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>prev<span class="token punctuation">,</span> curr<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> prev <span class="token operator">?</span> prev<span class="token punctuation">[</span>curr<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Get values to compare</span>
    <span class="token keyword">let</span> valueA <span class="token operator">=</span> <span class="token function">getPropertyValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> sortField<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> valueB <span class="token operator">=</span> <span class="token function">getPropertyValue</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> sortField<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Handle special cases for our data types</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sortField <span class="token operator">===</span> <span class="token string">'height'</span> <span class="token operator">||</span> sortField <span class="token operator">===</span> <span class="token string">'mass'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Convert to numbers for numeric comparison, handling 'unknown' values</span>
      valueA <span class="token operator">=</span> valueA <span class="token operator">===</span> <span class="token string">'unknown'</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>valueA<span class="token punctuation">)</span><span class="token punctuation">;</span>
      valueB <span class="token operator">=</span> valueB <span class="token operator">===</span> <span class="token string">'unknown'</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>valueB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sortField <span class="token operator">===</span> <span class="token string">'birth_year'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle 'BBY' (Before Battle of Yavin) format</span>
      valueA <span class="token operator">=</span> valueA <span class="token operator">===</span> <span class="token string">'unknown'</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">99999</span> <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>valueA<span class="token punctuation">)</span><span class="token punctuation">;</span>
      valueB <span class="token operator">=</span> valueB <span class="token operator">===</span> <span class="token string">'unknown'</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">99999</span> <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>valueB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Compare the values</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>valueA <span class="token operator">&lt;</span> valueB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> sortDirection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>valueA <span class="token operator">></span> valueB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">*</span> sortDirection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>This implementation does several important things:</p>
<ol>
<li>It creates a copy of the data array before sorting to avoid mutating the original</li>
<li>It handles different data types appropriately (numbers vs. strings)</li>
<li>It supports nested properties through the <code>getPropertyValue</code> helper method</li>
<li>It applies the sort direction ('asc' or 'desc') to the comparison result</li>
</ol>
<blockquote>
<p>The Ancient Order of Angular whispers of a time when developers had to write their own sort functions for every table. &quot;The Great Sorting Crisis of 2014,&quot; they call it, when thousands of developers independently implemented the same bubble sort algorithm with slightly different bugs. The MatSort directive was created shortly thereafter, a beacon of hope in the darkness of manual DOM manipulation.</p>
</blockquote>
<h2>Making Sort Headers Visually Distinct</h2>
<p>While our sorting functionality works, we want to make the sort headers more visually distinct to improve the user experience. Let's add some custom styles to make them stand out and provide better feedback when interacting with them.</p>
<p>We can add these styles to our component:</p>
<pre class="language-typescript"><code class="language-typescript">styles<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  .mat-mdc-row:nth-child(even) {
    background-color: rgba(255, 255, 255, 0.05);
  }

  .mat-mdc-row:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .mat-mdc-cell, .mat-mdc-header-cell {
    color: rgba(255, 255, 255, 0.7);
    padding: 16px;
  }

  /* Custom sort header styles */
  .mat-sort-header-container {
    align-items: center;
  }

  .mat-sort-header-arrow {
    color: #fbbf24 !important; /* tw-yellow-400 */
  }

  th.mat-header-cell.mat-sort-header:hover {
    background-color: rgba(251, 191, 36, 0.1); /* tw-yellow-400 with opacity */
    cursor: pointer;
  }

  th.mat-header-cell.mat-sort-header-sorted {
    background-color: rgba(251, 191, 36, 0.15); /* tw-yellow-400 with opacity */
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>These styles do several important things:</p>
<ol>
<li>They make the sort arrow yellow to match our Star Wars theme</li>
<li>They add a subtle hover effect to sort headers</li>
<li>They highlight the currently active sort column with a background color</li>
<li>They ensure proper alignment of the sort header content</li>
</ol>
<p>The Cosmic Compiler particularly appreciates when we maintain a consistent color theme throughout our application, so we're using the same <code>tw-yellow-400</code> color that we've been using for our text.</p>
<h2>Testing Our Sorting Implementation</h2>
<p>To ensure our sorting works correctly, we should test it with different data types and edge cases. Here's a simple test we can add to our component spec file:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/features/star-wars/components/character-list/character-list.component.spec.ts</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should sort data when sort header is clicked"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Arrange</span>
  <span class="token keyword">const</span> fixture <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span>CharacterListComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> component <span class="token operator">=</span> fixture<span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span>
  <span class="token keyword">const</span> dataSourceSpy <span class="token operator">=</span> <span class="token function">spyOn</span><span class="token punctuation">(</span>
    component<span class="token punctuation">.</span>dataSource<span class="token punctuation">,</span>
    <span class="token string">"loadCharacters"</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">callThrough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fixture<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Act - simulate sort event</span>
  <span class="token keyword">const</span> sortHeader <span class="token operator">=</span> fixture<span class="token punctuation">.</span>debugElement<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">"th.mat-sort-header"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sortHeader<span class="token punctuation">.</span><span class="token function">triggerEventHandler</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fixture<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Assert</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>dataSourceSpy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>pageIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Should reset to first page</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This test verifies that:</p>
<ol>
<li>Clicking a sort header triggers the <code>loadCharacters</code> method</li>
<li>The paginator resets to the first page when sorting changes</li>
</ol>
<h2>End-to-End Testing</h2>
<p>Unit tests are great for verifying component logic, but we also need to ensure our sorting works correctly in a real browser environment. Let's add some e2e tests using Playwright to verify our sorting functionality:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// e2e/sorting.spec.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> test<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@playwright/test"</span><span class="token punctuation">;</span>

test<span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"Character List Sorting"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  test<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> page <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Navigate to the character list page</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">"/characters"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Wait for the table to be visible</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">"table"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> timeout<span class="token operator">:</span> <span class="token number">30000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"should sort characters by name"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> page <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the initial order of character names</span>
    <span class="token keyword">const</span> initialNames <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$$eval</span><span class="token punctuation">(</span>
      <span class="token string">"table tbody tr td:first-child"</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>elements<span class="token punctuation">)</span> <span class="token operator">=></span> elements<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token operator">?.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Click on the name column header to sort</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'th:has-text("NAME")'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Wait for sorting to complete</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForTimeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the sorted order of character names</span>
    <span class="token keyword">const</span> sortedNames <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$$eval</span><span class="token punctuation">(</span>
      <span class="token string">"table tbody tr td:first-child"</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>elements<span class="token punctuation">)</span> <span class="token operator">=></span> elements<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token operator">?.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Verify the names are in alphabetical order</span>
    <span class="token keyword">const</span> sortedCopy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>sortedNames<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>sortedNames<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>sortedCopy<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"should sort characters by height"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> page <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the initial order of character heights</span>
    <span class="token keyword">const</span> initialHeights <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$$eval</span><span class="token punctuation">(</span>
      <span class="token string">"table tbody tr td:nth-child(4)"</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>elements<span class="token punctuation">)</span> <span class="token operator">=></span> elements<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token operator">?.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Click on the height column header to sort</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'th:has-text("HEIGHT")'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Wait for sorting to complete</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForTimeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Extract numeric values for comparison (remove 'cm' and convert to numbers)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getNumericHeight</span> <span class="token operator">=</span> <span class="token punctuation">(</span>h<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      <span class="token function">parseFloat</span><span class="token punctuation">(</span>h<span class="token operator">?.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"cm"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the sorted heights after clicking the header</span>
    <span class="token keyword">const</span> sortedHeights <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$$eval</span><span class="token punctuation">(</span>
      <span class="token string">"table tbody tr td:nth-child(4)"</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>elements<span class="token punctuation">)</span> <span class="token operator">=></span> elements<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token operator">?.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Verify the heights are in ascending numeric order</span>
    <span class="token keyword">const</span> currentHeights <span class="token operator">=</span> sortedHeights<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getNumericHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> sortedCopy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>currentHeights<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>currentHeights<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>sortedCopy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>These tests verify that:</p>
<ol>
<li>Clicking on the name column header sorts the names alphabetically</li>
<li>Clicking on the height column header sorts the heights numerically</li>
<li>The sorting works correctly for both string and numeric data</li>
</ol>
<blockquote>
<p>The Cosmic Compiler reminds us: &quot;End-to-end tests are your final defense against the chaos of production. They verify not just that your code works in isolation, but that all the pieces work together as a harmonious whole.&quot;</p>
</blockquote>
<h2>Server-Side Sorting Support</h2>
<blockquote>
<p><strong>Technical Note:</strong> The actual SWAPI (Star Wars API) doesn't natively support sorting parameters. In a production environment, you'd either need to implement client-side sorting or use a backend proxy that adds sorting capabilities. For our tutorial, we've implemented sorting in our MSW mocks to simulate how a real API with sorting support would work.</p>
</blockquote>
<p>To ensure our sorting works with real API calls, we need to update our mock handlers to support sorting parameters:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/mocks/handlers.ts</span>
<span class="token comment">// Get sort parameters if they exist</span>
<span class="token keyword">const</span> sortField <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sort_by"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sortDirection <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"sort_direction"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sort the characters if sort parameters are provided</span>
<span class="token keyword">let</span> sortedCharacters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>characters<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>sortField <span class="token operator">&amp;&amp;</span> sortDirection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sortedCharacters<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Use type assertion to handle property access</span>
    <span class="token keyword">const</span> aValue <span class="token operator">=</span> a<span class="token punctuation">.</span>properties<span class="token punctuation">[</span>sortField <span class="token keyword">as</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> a<span class="token punctuation">.</span>properties<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> bValue <span class="token operator">=</span> b<span class="token punctuation">.</span>properties<span class="token punctuation">[</span>sortField <span class="token keyword">as</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> b<span class="token punctuation">.</span>properties<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Handle numeric sorting</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>aValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>bValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> sortDirection <span class="token operator">===</span> <span class="token string">"asc"</span>
        <span class="token operator">?</span> <span class="token function">Number</span><span class="token punctuation">(</span>aValue<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">Number</span><span class="token punctuation">(</span>bValue<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>bValue<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">Number</span><span class="token punctuation">(</span>aValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Handle string sorting</span>
    <span class="token keyword">return</span> sortDirection <span class="token operator">===</span> <span class="token string">"asc"</span>
      <span class="token operator">?</span> <span class="token function">String</span><span class="token punctuation">(</span>aValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>bValue<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span>bValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>aValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>This mock handler implementation ensures that our API mocks properly support sorting, making our e2e tests more realistic and reliable.</p>
<p>We also need to update our <code>StarWarsService</code> to pass the sorting parameters to the API:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/core/services/star-wars.service.ts</span>
<span class="token function">getCharacters</span><span class="token punctuation">(</span>
  page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  limit<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
  sortField<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  sortDirection<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>ApiResponse<span class="token operator">&lt;</span>Character<span class="token operator">>></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'limit'</span><span class="token punctuation">,</span> limit<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'expanded'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add sort parameters if provided</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sortField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    params <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'sort_by'</span><span class="token punctuation">,</span> sortField<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sortDirection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    params <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'sort_direction'</span><span class="token punctuation">,</span> sortDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>ApiResponse<span class="token operator">&lt;</span>Character<span class="token operator">>></span></span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>apiUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">people</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Finally, we update our <code>GalacticDataSource</code> to pass the sorting parameters to the service:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/features/star-wars/datasources/galactic-datasource.ts</span>
<span class="token function">loadCharacters</span><span class="token punctuation">(</span>
  page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  sortField<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  sortDirection<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  pageSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span>value
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sortField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sortSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> active<span class="token operator">:</span> sortField<span class="token punctuation">,</span> direction<span class="token operator">:</span> sortDirection <span class="token keyword">as</span> <span class="token string">'asc'</span> <span class="token operator">|</span> <span class="token string">'desc'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>starWarsService
    <span class="token punctuation">.</span><span class="token function">getCharacters</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">,</span> sortField<span class="token punctuation">,</span> sortDirection<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Handle the response...</span>
<span class="token punctuation">}</span></code></pre>
<h2>Cosmic Compiler Summary</h2>
<ul>
<li>We've <strong>implemented client-side sorting</strong> with MatSort for our Galactic Archives table</li>
<li>We've <strong>handled different data types</strong> in our sort function (strings vs. numbers)</li>
<li>We've <strong>dealt with nested properties</strong> in our character objects</li>
<li>We've <strong>made sort headers visually distinct</strong> with custom styling</li>
<li>We've <strong>connected sorting with pagination</strong> to create a seamless user experience</li>
<li>We've <strong>added e2e tests</strong> to verify sorting functionality in a real browser environment</li>
<li>We've <strong>implemented server-side sorting support</strong> in our mock handlers</li>
</ul>
<blockquote>
<p>The Cosmic Compiler reviewed our sorting implementation and, after a tense moment of silence, nodded approvingly. &quot;The code respects both the data and the user,&quot; it whispered. &quot;It handles edge cases gracefully and maintains visual consistency.&quot; The junior developers in the room let out a collective sigh of relief. The Compiler's approval is rare and precious.</p>
</blockquote>
<h2>Next Steps</h2>
<p>With sorting and pagination in place, our Galactic Archives are becoming increasingly powerful. But users are demanding more control over the data they see. In our next transmission, we'll implement filtering capabilities to allow users to search for specific characters based on various criteria. Prepare your quantum processors for &quot;Part 10: Implementing Advanced Filtering&quot; - where we'll teach our DataSource to sift through the noise and find the droids you're looking for.</p>
<p>Until then, may your builds be green and your runtime errors few.</p>

  </article>
  
  <section>
    <hr>
    
    <div class="series-navigation">
      
      <p>
        <a href="/musings/post-8-implementing-pagination/">← Previous</a>
        
 |         <a href="/musings/galactic-archives-series/">Series Overview</a>
        
 |         <a href="/musings/post-10-implementing-filtering/">Next →</a>
      </p>
    </div>
    
    <div class="post-footer">
      <p><a href="/musings/">← Back to all musings</a></p>
      
    </div>
  </section>
</main>

    </article>
  </body>
</html>
