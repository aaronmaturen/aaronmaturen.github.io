<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Building client and server-side pagination with infinite scrolling and virtual scrolling techniques for large Star Wars datasets" />
    <link rel="shortcut icon" href="/assets/ico/favicon.ico" />
    <title>Galactic Archives - Implementing Pagination</title>
    <link rel="stylesheet" href="/assets/css/tufte.min.css" />
    <link rel="stylesheet" href="/assets/css/prism-theme.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />
    <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="Aaron T. Maturen's Musings" />
  </head>
  <body>
    <div class="progress-container"></div>
    <article>

<nav class="tw-breadcrumbs" aria-label="Breadcrumbs">
  <ol>
    <li>
      <a href="/" aria-label="Home">Home</a>
    </li>
        <li>
            <a href="/musings">Musings</a>
        </li>
        <li>
            <span aria-current="page">Post 8 implementing pagination</span>
        </li>
  </ol>
</nav>
        
<header>
  <h1>Galactic Archives - Implementing Pagination</h1>
  <p class="subtitle">June 8, 2025</p>
  
  <p class="code-links">
    <a href="https://github.com/aaronmaturen/galactic-archives/tree/post-8" target="_blank" rel="noopener">View on GitHub</a> | 
    <a href="https://stackblitz.com/fork/github/aaronmaturen/galactic-archives/tree/post-8" target="_blank" rel="noopener">Run on StackBlitz</a>
  </p>
</header>

<main>
  <article>
    <h1>Angular DataSource with SWAPI: Building the Galactic Archives - Implementing Pagination</h1>
<p><em>The Cosmic Compiler once observed that data without pagination is like a library without shelves - technically functional but practically unusable. As our collection of galactic characters grows, we need a more sophisticated way to present and navigate through them.</em></p>
<h2>From Cards to Tables: A Galactic Upgrade</h2>
<p>In our previous transmission, we implemented a basic DataSource to manage our Star Wars character data. We displayed this data using Material cards, which worked well for our initial prototype. However, as the Ancient Order of Angular teaches, &quot;When data grows structured, tables become the way.&quot;</p>
<p>Today, we'll transition from our card-based layout to a powerful MatTable implementation, which will allow us to:</p>
<ol>
<li>Display data in a structured, tabular format</li>
<li>Add pagination to navigate through large datasets</li>
<li>Prepare for sorting capabilities (coming in our next transmission)</li>
</ol>
<blockquote>
<p>A padawan developer once complained to the Council of Patterns about having to refactor a card layout to a table. &quot;But I've already built it!&quot; they protested. The Council replied, &quot;The code that cannot be refactored becomes the technical debt that cannot be repaid.&quot; The Cosmic Compiler, listening nearby, added a deprecation warning to the padawan's favorite component just to drive the point home.</p>
</blockquote>
<h2>The Anatomy of a Galactic Table</h2>
<p>Before diving into code, let's understand the key components we'll be working with:</p>
<ol>
<li><strong>MatTable</strong>: The core component that renders our data in rows and columns</li>
<li><strong>MatPaginator</strong>: Controls navigation between pages of data</li>
<li><strong>DataSource</strong>: Our existing class that will now feed data to the table</li>
</ol>
<p>Think of MatTable as the viewport of a starship - it only shows a small portion of the vast galaxy at any given time. The MatPaginator is like the navigation system, allowing us to jump to different sectors of space. Our DataSource is the ship's computer, fetching and processing the star charts we need.</p>
<h2>Implementing MatTable</h2>
<p>First, let's update our imports to include the necessary Material modules:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/features/star-wars/components/character-list/character-list.component.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> OnInit<span class="token punctuation">,</span> OnDestroy<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> ViewChild<span class="token punctuation">,</span> AfterViewInit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatTableModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/material/table'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatProgressSpinnerModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/material/progress-spinner'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatPaginatorModule<span class="token punctuation">,</span> MatPaginator <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/material/paginator'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MatIconModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/material/icon'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StarWarsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../core/services/star-wars.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GalacticDataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../datasources/galactic-datasource'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Character <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../../models/character.model'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span></code></pre>
<p>Notice we've added several new imports:</p>
<ul>
<li><code>MatTableModule</code> and <code>MatTable</code> for our table component</li>
<li><code>MatPaginatorModule</code> and <code>MatPaginator</code> for pagination</li>
<li><code>AfterViewInit</code> interface since we'll need to access the paginator after view initialization</li>
<li><code>ViewChild</code> which we'll use to get a reference to the paginator</li>
</ul>
<blockquote>
<p>The Cosmic Compiler once remarked, &quot;A component without proper imports is like a Jedi without a lightsaber - technically present but practically useless.&quot; Always double-check your imports before wondering why your component isn't working!</p>
</blockquote>
<p>@Component({
selector: 'app-character-list',
standalone: true,
imports: [
CommonModule,
MatTableModule,
MatProgressSpinnerModule,
MatPaginatorModule,
MatIconModule
],</p>
<pre><code>
Here we're setting up our component as a standalone component with the necessary imports. This follows the modern Angular approach of using standalone components rather than NgModules for better tree-shaking and more explicit dependencies.

Now let's look at the template where most of the magic happens:

```typescript
  template: `
    &lt;div class=&quot;tw-container tw-mx-auto tw-p-4&quot;&gt;
      &lt;h1 data-testid=&quot;character-list-heading&quot; class=&quot;tw-text-2xl tw-font-bold tw-mb-4&quot;&gt;
        Galactic Archives: Character Database
      &lt;/h1&gt;

      &lt;!-- Loading indicator --&gt;
      &lt;div *ngIf=&quot;loading &amp;&amp; !characters.length&quot; class=&quot;tw-flex tw-justify-center tw-my-8&quot;&gt;
        &lt;mat-spinner diameter=&quot;50&quot;&gt;&lt;/mat-spinner&gt;
      &lt;/div&gt;

      &lt;!-- Error message display --&gt;
      &lt;div
        *ngIf=&quot;error&quot;
        data-testid=&quot;error-message&quot;
        class=&quot;tw-bg-red-100 tw-border-l-4 tw-border-red-500 tw-text-red-700 tw-p-4 tw-mb-4&quot;
      &gt;
        {{ error }}
      &lt;/div&gt;
</code></pre>
<p>We start with a container for our component, a title, and handling for loading and error states. Notice we're using Tailwind CSS classes with the <code>tw-</code> prefix as per our project standards.</p>
<p>Next comes the table implementation:</p>
<pre class="language-typescript"><code class="language-typescript">      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Table container <span class="token keyword">with</span> Star Wars theme <span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-bg-white tw-rounded-lg tw-overflow-hidden tw-shadow-lg"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The MatTable <span class="token keyword">with</span> our DataSource <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>table mat<span class="token operator">-</span>table <span class="token punctuation">[</span>dataSource<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"dataSource"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-w-full"</span> data<span class="token operator">-</span>testid<span class="token operator">=</span><span class="token string">"character-table"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Name Column <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>ng<span class="token operator">-</span>container matColumnDef<span class="token operator">=</span><span class="token string">"name"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>th mat<span class="token operator">-</span>header<span class="token operator">-</span>cell <span class="token operator">*</span>matHeaderCellDef <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-blue-700"</span><span class="token operator">></span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-flex tw-items-center"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>mat<span class="token operator">-</span>icon <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-mr-1 tw-text-base tw-text-blue-700"</span><span class="token operator">></span>person<span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>icon<span class="token operator">></span>
                <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token constant">NAME</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">></span>
            <span class="token operator">&lt;</span>td
              mat<span class="token operator">-</span>cell
              <span class="token operator">*</span>matCellDef<span class="token operator">=</span><span class="token string">"let character"</span>
              <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-black tw-font-medium"</span>
              data<span class="token operator">-</span>testid<span class="token operator">=</span><span class="token string">"character-name"</span>
            <span class="token operator">></span>
              <span class="token punctuation">{</span><span class="token punctuation">{</span> character<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>ng<span class="token operator">-</span>container<span class="token operator">></span></code></pre>
<p>Here we begin our table implementation using <code>mat-table</code> and binding it to our DataSource. For each column, we define a <code>matColumnDef</code> with a unique name that matches the property in our <code>displayedColumns</code> array. Each column has both a header cell (<code>th</code>) and a data cell (<code>td</code>) template.</p>
<p>Let's continue with the remaining columns:</p>
<pre class="language-typescript"><code class="language-typescript">          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Gender Column <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>ng<span class="token operator">-</span>container matColumnDef<span class="token operator">=</span><span class="token string">"gender"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>th mat<span class="token operator">-</span>header<span class="token operator">-</span>cell <span class="token operator">*</span>matHeaderCellDef <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-blue-700"</span><span class="token operator">></span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-flex tw-items-center"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>mat<span class="token operator">-</span>icon <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-mr-1 tw-text-base tw-text-blue-700"</span><span class="token operator">></span>wc<span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>icon<span class="token operator">></span>
                <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token constant">GENDER</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">></span>
            <span class="token operator">&lt;</span>td mat<span class="token operator">-</span>cell <span class="token operator">*</span>matCellDef<span class="token operator">=</span><span class="token string">"let character"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> character<span class="token punctuation">.</span>gender <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>ng<span class="token operator">-</span>container<span class="token operator">></span>

          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Birth Year Column <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>ng<span class="token operator">-</span>container matColumnDef<span class="token operator">=</span><span class="token string">"birth_year"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>th mat<span class="token operator">-</span>header<span class="token operator">-</span>cell <span class="token operator">*</span>matHeaderCellDef <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-blue-700"</span><span class="token operator">></span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-flex tw-items-center"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>mat<span class="token operator">-</span>icon <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-mr-1 tw-text-base tw-text-blue-700"</span><span class="token operator">></span>cake<span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>icon<span class="token operator">></span>
                <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token constant">BIRTH</span> <span class="token constant">YEAR</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">></span>
            <span class="token operator">&lt;</span>td mat<span class="token operator">-</span>cell <span class="token operator">*</span>matCellDef<span class="token operator">=</span><span class="token string">"let character"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> character<span class="token punctuation">.</span>birth_year <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>ng<span class="token operator">-</span>container<span class="token operator">></span>

          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Height Column <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>ng<span class="token operator">-</span>container matColumnDef<span class="token operator">=</span><span class="token string">"height"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>th mat<span class="token operator">-</span>header<span class="token operator">-</span>cell <span class="token operator">*</span>matHeaderCellDef <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-blue-700"</span><span class="token operator">></span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-flex tw-items-center"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>mat<span class="token operator">-</span>icon <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-mr-1 tw-text-base tw-text-blue-700"</span><span class="token operator">></span>height<span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>icon<span class="token operator">></span>
                <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token constant">HEIGHT</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">></span>
            <span class="token operator">&lt;</span>td mat<span class="token operator">-</span>cell <span class="token operator">*</span>matCellDef<span class="token operator">=</span><span class="token string">"let character"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> character<span class="token punctuation">.</span>height <span class="token punctuation">}</span><span class="token punctuation">}</span>cm<span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>ng<span class="token operator">-</span>container<span class="token operator">></span></code></pre>
<p>We follow the same pattern for each column, using appropriate icons that match the data being displayed. Notice how we're using the Star Wars yellow color theme with <code>tw-text-yellow-400</code> for headers.</p>
<p>Now we need to define how rows should be rendered:</p>
<pre class="language-typescript"><code class="language-typescript">          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Row definitions <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>tr mat<span class="token operator">-</span>header<span class="token operator">-</span>row <span class="token operator">*</span>matHeaderRowDef<span class="token operator">=</span><span class="token string">"displayedColumns"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>
          <span class="token operator">&lt;</span>tr mat<span class="token operator">-</span>row <span class="token operator">*</span>matRowDef<span class="token operator">=</span><span class="token string">"let row; columns: displayedColumns;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>

          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Row shown when there <span class="token keyword">is</span> no matching data <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>tr <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-mat-row"</span> <span class="token operator">*</span>matNoDataRow<span class="token operator">></span>
            <span class="token operator">&lt;</span>td <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-mat-cell tw-p-4 tw-text-center"</span> colspan<span class="token operator">=</span><span class="token string">"4"</span><span class="token operator">></span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-flex tw-flex-col tw-items-center tw-py-8"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>mat<span class="token operator">-</span>icon <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-4xl tw-text-gray-500 tw-mb-2"</span>
                  <span class="token operator">></span>sentiment_very_dissatisfied<span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>icon
                <span class="token operator">></span>
                <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-text-gray-500"</span><span class="token operator">></span>No characters found <span class="token keyword">in</span> the archives<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">></span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Loading indicator <span class="token keyword">for</span> when data <span class="token keyword">is</span> loading but we have existing data <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>div <span class="token operator">*</span>ngIf<span class="token operator">=</span><span class="token string">"loading &amp;&amp; characters.length"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-flex tw-justify-center tw-py-4"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>mat<span class="token operator">-</span>spinner diameter<span class="token operator">=</span><span class="token string">"30"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>spinner<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Paginator <span class="token keyword">with</span> Star Wars theme <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>mat<span class="token operator">-</span>paginator
          <span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"totalCount"</span>
          <span class="token punctuation">[</span>pageSize<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"pageSize"</span>
          <span class="token punctuation">[</span>pageSizeOptions<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"[5, 10, 25]"</span>
          aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"Select page of characters"</span>
          <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"tw-bg-gray-100 tw-border-t tw-border-gray-200"</span>
        <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>mat<span class="token operator">-</span>paginator<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,
  styles: [
    </span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">.</span>mat<span class="token operator">-</span>mdc<span class="token operator">-</span>row<span class="token operator">:</span>nth<span class="token operator">-</span><span class="token function">child</span><span class="token punctuation">(</span>even<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">.</span>mat<span class="token operator">-</span>mdc<span class="token operator">-</span>row<span class="token operator">:</span>hover <span class="token punctuation">{</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">.</span>mat<span class="token operator">-</span>mdc<span class="token operator">-</span>cell<span class="token punctuation">,</span>
      <span class="token punctuation">.</span>mat<span class="token operator">-</span>mdc<span class="token operator">-</span>header<span class="token operator">-</span>cell <span class="token punctuation">{</span>
        color<span class="token operator">:</span> #<span class="token number">000000</span><span class="token punctuation">;</span>
        padding<span class="token operator">:</span> 16px<span class="token punctuation">;</span>
        border<span class="token operator">-</span>bottom<span class="token operator">:</span> 1px solid <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">.</span>mat<span class="token operator">-</span>mdc<span class="token operator">-</span>header<span class="token operator">-</span>cell <span class="token punctuation">{</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        font<span class="token operator">-</span>weight<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>We've added some styles to make our table look more like a Star Wars terminal - with subtle zebra striping, hover effects, and proper spacing. The dark background with light text gives it that &quot;galactic database&quot; feel.</p>
<blockquote>
<p>The Ancient Order of Angular teaches that &quot;The user interface is the gateway to your application's soul.&quot; A well-styled table not only improves usability but creates an immersive experience that keeps users engaged with your data.</p>
</blockquote>
<p>Now let's look at the component class implementation:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CharacterListComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> AfterViewInit<span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  <span class="token comment">// Properties for our table and pagination</span>
  characters<span class="token operator">:</span> Character<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  displayedColumns<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">,</span> <span class="token string">'birth_year'</span><span class="token punctuation">,</span> <span class="token string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  error <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  totalCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// Reference to the paginator in our template</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">ViewChild</span></span><span class="token punctuation">(</span>MatPaginator<span class="token punctuation">)</span> paginator<span class="token operator">!</span><span class="token operator">:</span> MatPaginator<span class="token punctuation">;</span>

  <span class="token comment">// Services and DataSource</span>
  <span class="token keyword">private</span> starWarsService <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>StarWarsService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  dataSource<span class="token operator">!</span><span class="token operator">:</span> GalacticDataSource<span class="token punctuation">;</span> <span class="token comment">// Using definite assignment assertion</span>
  <span class="token keyword">private</span> subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create our DataSource instance</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GalacticDataSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>starWarsService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Subscribe to character data changes</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>characters <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>characters <span class="token operator">=</span> characters<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Subscribe to loading state</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span>loading$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>isLoading <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> isLoading<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Subscribe to count</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span>count$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>count <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>totalCount <span class="token operator">=</span> count<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Initial data load - start with page 1 and current page size</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadCharacters</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>In <code>ngOnInit()</code>, we set up subscriptions to our DataSource's observables. This is where we connect the component's state to the DataSource's state. We're subscribing to:</p>
<ol>
<li><code>loading$</code> - to show/hide the loading spinner</li>
<li><code>count$</code> - to update the total number of characters for the paginator</li>
</ol>
<p>We also trigger the initial data load.</p>
<blockquote>
<p>The Council of Patterns warns: &quot;Never access ViewChild references in ngOnInit() - they are undefined until the view is initialized. Many a padawan has fallen into this trap, leading to the dreaded 'undefined' errors in the console.&quot;</p>
</blockquote>
<pre class="language-typescript"><code class="language-typescript">  <span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Connect paginator to our datasource after view init</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle paginator events</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>event <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token comment">// Convert from 0-based to 1-based pagination for the API</span>
          <span class="token keyword">const</span> apiPage <span class="token operator">=</span> event<span class="token punctuation">.</span>pageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadCharacters</span><span class="token punctuation">(</span>apiPage<span class="token punctuation">,</span> event<span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Clean up subscriptions when the component is destroyed</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// The DataSource will handle its own cleanup in disconnect()</span>
  <span class="token punctuation">}</span></code></pre>
<p>The <code>ngAfterViewInit()</code> lifecycle hook runs after Angular has fully initialized the component's view. This is important because we need to access the <code>paginator</code> reference which isn't available until the view is initialized. Here we subscribe to the paginator's page events to reload data when the user changes pages.</p>
<blockquote>
<p>The Council of Patterns warns: &quot;Never access ViewChild references in ngOnInit() - they are undefined until the view is initialized. Many a padawan has fallen into this trap, leading to the dreaded 'undefined' errors in the console.&quot;</p>
</blockquote>
<pre class="language-typescript"><code class="language-typescript">  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Clean up subscriptions when the component is destroyed</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// The DataSource will handle its own cleanup in disconnect()</span>
    <span class="token comment">// Clean up subscriptions</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscriptions<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>The <code>ngOnDestroy()</code> method is our cleanup phase. By unsubscribing from all subscriptions when the component is destroyed, we prevent memory leaks. The Recursive Philosopher once noted, &quot;A component that does not clean up after itself is like a spaceship leaving debris in its wake - eventually, it will cause problems for future travelers.&quot;</p>
<pre class="language-typescript"><code class="language-typescript">  <span class="token function">loadCharacters</span><span class="token punctuation">(</span>page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// Update the page size if it changed</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize <span class="token operator">=</span> pageSize<span class="token punctuation">;</span>
      <span class="token comment">// Let the DataSource handle loading the data</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource<span class="token punctuation">.</span><span class="token function">loadCharacters</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed to load characters: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error <span class="token keyword">instanceof</span> <span class="token class-name">Error</span> <span class="token operator">?</span> error<span class="token punctuation">.</span>message <span class="token operator">:</span> <span class="token string">'Unknown error'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. The Cosmic Compiler is displeased.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Updating the DataSource for Pagination</h2>
<p>Now, let's enhance our GalacticDataSource to handle pagination properly. We'll build on the foundation we created in the previous post, adding new features specifically for pagination.</p>
<p>First, let's look at the imports and state management:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/features/star-wars/datasources/galactic-datasource.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DataSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/cdk/collections'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BehaviorSubject<span class="token punctuation">,</span> Observable<span class="token punctuation">,</span> Subscription <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> finalize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Character <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../models/character.model'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StarWarsService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../core/services/star-wars.service'</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * GalacticDataSource - A DataSource implementation for Star Wars characters
 *
 * As the Ancient Order of Angular foretold, "The DataSource shall liberate thy components
 * from the burden of data management, allowing them to focus on their true purpose."
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GalacticDataSource</span> <span class="token keyword">extends</span> <span class="token class-name">DataSource<span class="token operator">&lt;</span>Character<span class="token operator">></span></span> <span class="token punctuation">{</span>
  <span class="token comment">// BehaviorSubjects to manage internal state</span>
  <span class="token keyword">private</span> charactersSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject<span class="token operator">&lt;</span>Character<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> loadingSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> countSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> pageSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Track current page</span>
  <span class="token keyword">private</span> pageSizeSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Track page size</span>

  <span class="token comment">// Public observables that components can subscribe to</span>
  <span class="token keyword">public</span> loading$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> count$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> page$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> pageSize$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Track active subscriptions for cleanup</span>
  <span class="token keyword">private</span> subscription <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The key addition here is the <code>pageSubject</code> which tracks the current page. This allows components to react to page changes and enables features like &quot;current page&quot; indicators. We expose this as a public observable <code>page$</code> that components can subscribe to.</p>
<blockquote>
<p>The Recursive Philosopher once said, &quot;To truly understand state management, one must first understand that state is merely a snapshot of truth at a given moment in time.&quot; The Ancient Order of Angular nodded in agreement, then proceeded to create BehaviorSubject to make this philosophical concept concrete.</p>
</blockquote>
<p>Next, let's look at the constructor and required DataSource methods:</p>
<pre class="language-typescript"><code class="language-typescript">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> starWarsService<span class="token operator">:</span> StarWarsService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Connect function that's called by the table to retrieve a stream of data
   * The Cosmic Compiler demands a proper implementation of this abstract method
   */</span>
  <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Character<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Disconnect function that's called when the table is destroyed
   * The Council of Patterns insists on proper cleanup to prevent memory leaks
   */</span>
  <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>The <code>connect()</code> method remains the same as before - it's the bridge between our DataSource and the table. The <code>disconnect()</code> method now includes completing our new <code>pageSubject</code> to prevent memory leaks.</p>
<p>Now for the most important part - loading data with pagination:</p>
<pre class="language-typescript"><code class="language-typescript">  <span class="token comment">/**
   * Load characters from the Star Wars API
   * @param page The page number to load (1-based)
   * @param pageSize The number of items per page
   */</span>
  <span class="token function">loadCharacters</span><span class="token punctuation">(</span>page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Log the request parameters for debugging</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Loading characters: page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, pageSize=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Clear current data when loading new page</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>starWarsService
      <span class="token punctuation">.</span><span class="token function">getCharacters</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> subscription <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">next</span><span class="token operator">:</span> response <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// Update our subjects with the new data</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>
          response<span class="token punctuation">.</span>results
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=></span> item<span class="token punctuation">.</span>properties<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token operator">:</span> char <span class="token keyword">is</span> Character <span class="token operator">=></span> char <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>total_records<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">error</span><span class="token operator">:</span> error <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error loading characters:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Keep the current page and page size values to allow retry</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Add to our subscription for cleanup</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subscription<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre>
<p>There are several key changes in this method:</p>
<ol>
<li>We update the <code>pageSubject</code> with the current page number</li>
<li>We clear the existing data by setting an empty array (<code>[]</code>) before loading new data</li>
<li>We use the page parameter in our service call to fetch the correct page of data</li>
</ol>
<p>This is different from an &quot;infinite scroll&quot; approach where you would append new data to existing data. With pagination, we replace the entire dataset when changing pages.</p>
<p>Finally, let's add some utility methods to help with pagination:</p>
<pre class="language-typescript"><code class="language-typescript">  <span class="token comment">/**
   * Get the current data without subscribing
   */</span>
  <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Character<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Get the current page number without subscribing
   */</span>
  <span class="token function">getCurrentPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Get the current page size without subscribing
   */</span>
  <span class="token function">getCurrentPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Clear all data in the DataSource
   */</span>
  <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>countSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reset to default page size</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>These helper methods allow components to:</p>
<ol>
<li>Get the current data synchronously without subscribing</li>
<li>Check the current page number</li>
<li>Reset the DataSource to its initial state</li>
</ol>
<p>These are particularly useful for testing and for handling edge cases like resetting filters.</p>
<h2>Updating the StarWarsService for Page Size Support</h2>
<p>To fully support pagination with dynamic page sizes, we need to update our StarWarsService to accept and use the page size parameter when making API requests:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/core/services/star-wars.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient<span class="token punctuation">,</span> HttpErrorResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable<span class="token punctuation">,</span> throwError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> retry<span class="token punctuation">,</span> map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> environment <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../environments/environment'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Character<span class="token punctuation">,</span> CharacterListItem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../models/character.model'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApiResponse<span class="token punctuation">,</span> ApiDetailResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../models/api-response.model'</span><span class="token punctuation">;</span>

<span class="token comment">// Type aliases for our specific use cases</span>
<span class="token keyword">type</span> <span class="token class-name">CharacterResponse</span> <span class="token operator">=</span> ApiResponse<span class="token operator">&lt;</span>CharacterListItem<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">CharacterDetailResponse</span> <span class="token operator">=</span> ApiDetailResponse<span class="token operator">&lt;</span>Character<span class="token operator">></span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token comment">// The Ancient Order approves of this modern injection approach</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">StarWarsService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> apiUrl <span class="token operator">=</span> environment<span class="token punctuation">.</span>apiUrl<span class="token punctuation">;</span>
  <span class="token keyword">private</span> http <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>HttpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fetch all characters with optional pagination</span>
  <span class="token function">getCharacters</span><span class="token punctuation">(</span>page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>CharacterResponse<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment">// The Cosmic Compiler demands proper URL formatting</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>apiUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">people?page=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>page<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;limit=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;expanded=true</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">API Request URL: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>CharacterResponse<span class="token operator">></span></span></span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// The Cosmic Compiler suggests retrying failed requests</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleError<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The key changes here are:</p>
<ol>
<li>Adding a <code>pageSize</code> parameter with a default value of 10</li>
<li>Using this parameter in the URL construction with the <code>limit</code> query parameter</li>
<li>Adding logging to help debug pagination issues</li>
</ol>
<h2>Understanding Pagination Differences</h2>
<p>One important detail to note is that SWAPI uses 1-based pagination (pages start at 1), while Angular Material's MatPaginator uses 0-based pagination (pages start at 0). This inconsistency is a classic example of the integration challenges developers face when connecting different systems.</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Converting from MatPaginator's 0-based index to SWAPI's 1-based index</span>
<span class="token keyword">const</span> apiPage <span class="token operator">=</span> event<span class="token punctuation">.</span>pageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>The Recursive Philosopher once pondered, &quot;Is the first page page 0 or page 1? The answer depends not on mathematical truth but on which API you're consuming.&quot; The Ancient Order of Angular nodded sagely, having dealt with this exact inconsistency across countless projects. Legend has it that during the Great Framework Wars of 2015, entire development teams were torn apart over this very question.</p>
</blockquote>
<p>This conversion is crucial because if we don't account for it, we'll always be one page off in our requests. For example, when the user clicks on page 2 in the UI (which is index 1 in MatPaginator), we need to request page 3 from SWAPI.</p>
<h2>Handling Pagination Events</h2>
<p>The MatPaginator emits events when the user changes the page or page size. We subscribe to these events in the <code>ngAfterViewInit</code> lifecycle hook:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token function">ngAfterViewInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>page<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>event <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> apiPage <span class="token operator">=</span> event<span class="token punctuation">.</span>pageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Convert from 0-based to 1-based for API</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadCharacters</span><span class="token punctuation">(</span>apiPage<span class="token punctuation">,</span> event<span class="token punctuation">.</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The <code>page</code> event contains valuable information:</p>
<ul>
<li><code>pageIndex</code>: The current page index (0-based)</li>
<li><code>pageSize</code>: The number of items per page</li>
<li><code>length</code>: The total number of items</li>
<li><code>previousPageIndex</code>: The previous page index</li>
</ul>
<p>Notice a few important details in our implementation:</p>
<ol>
<li>We check if <code>this.paginator</code> exists before trying to subscribe to it</li>
<li>We add the subscription to our composite <code>subscription</code> object for proper cleanup</li>
<li>We convert from the 0-based index used by Angular Material to the 1-based index used by our API</li>
<li>We pass both the page and page size to our <code>loadCharacters</code> method</li>
</ol>
<p>By subscribing to this event, we create a reactive system where any user interaction with the paginator automatically triggers a data reload with the appropriate parameters.</p>
<h2>Managing State During Pagination</h2>
<p>Unlike infinite scroll implementations where we append new data to existing data, with pagination we replace the entire dataset on each page change:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token function">loadCharacters</span><span class="token punctuation">(</span>page<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pageSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pageSizeSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>charactersSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>starWarsService
    <span class="token punctuation">.</span><span class="token function">getCharacters</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>loadingSubject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> subscription <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subscription<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>This replacement approach has several benefits:</p>
<ol>
<li><strong>Memory efficiency</strong>: We only keep the current page in memory, which is especially important when dealing with potentially large datasets</li>
<li><strong>Simpler state management</strong>: No need to track which items belong to which page or maintain complex caching logic</li>
<li><strong>Consistent with user expectations</strong>: Users expect to see only the current page's data when using a paginated interface</li>
<li><strong>Cleaner UI transitions</strong>: By clearing the data before loading new data, we avoid showing stale data during page transitions</li>
<li><strong>Better error handling</strong>: If an error occurs during loading, we don't have a mix of old and new data</li>
</ol>
<blockquote>
<p>The Cosmic Compiler once witnessed a developer trying to implement pagination by keeping all pages in memory and just showing/hiding rows. It promptly crashed the developer's IDE and left a single error message: &quot;The path to efficient pagination is not through hiding, but through loading only what is needed.&quot;</p>
</blockquote>
<h2>Accessibility Considerations</h2>
<p>Our implementation includes several accessibility features:</p>
<ol>
<li>The paginator has an <code>aria-label</code> that describes its purpose</li>
<li>We've added <code>data-testid</code> attributes to key elements for better testing and automation</li>
<li>The loading spinner provides visual feedback during page transitions with different states:
<ul>
<li>Full-screen spinner when no data is available</li>
<li>Smaller spinner at the bottom when changing pages with existing data</li>
</ul>
</li>
<li>Error messages are clearly displayed when issues occur with appropriate styling</li>
<li>Proper color contrast in our UI elements using our branding colors</li>
</ol>
<p>These considerations ensure that our galactic database is usable by all beings across the universe, regardless of their abilities or the assistive technologies they might be using. The Ancient Order of Angular has always emphasized that accessibility is not an afterthought but a fundamental aspect of good application design.</p>
<h2>Testing Our Paginated Table</h2>
<p>Let's run our application and see our new table with pagination in action:</p>
<pre class="language-bash"><code class="language-bash">ng serve</code></pre>
<p>Navigate to <code>http://localhost:4200</code> and you should see:</p>
<ol>
<li>A table displaying Star Wars characters with multiple columns</li>
<li>A paginator at the bottom showing the total number of records</li>
<li>The ability to navigate between pages</li>
<li>Options to change the page size</li>
</ol>
<p>Try clicking through different pages and changing the page size. Notice how the DataSource handles these interactions smoothly, updating the display and maintaining the correct state.</p>
<h3>Automated Testing</h3>
<p>We've added <code>data-testid</code> attributes to key elements to make our component easier to test. Here's a simple test that verifies our pagination functionality:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'CharacterListComponent'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> component<span class="token operator">:</span> CharacterListComponent<span class="token punctuation">;</span>
  <span class="token keyword">let</span> fixture<span class="token operator">:</span> ComponentFixture<span class="token operator">&lt;</span>CharacterListComponent<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> mockStarWarsService<span class="token operator">:</span> jasmine<span class="token punctuation">.</span>SpyObj<span class="token operator">&lt;</span>StarWarsService<span class="token operator">></span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    mockStarWarsService <span class="token operator">=</span> jasmine<span class="token punctuation">.</span><span class="token function">createSpyObj</span><span class="token punctuation">(</span><span class="token string">'StarWarsService'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'getCharacters'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> TestBed<span class="token punctuation">.</span><span class="token function">configureTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>CharacterListComponent<span class="token punctuation">,</span> MatPaginatorModule<span class="token punctuation">,</span> MatTableModule<span class="token punctuation">]</span><span class="token punctuation">,</span>
      providers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> provide<span class="token operator">:</span> StarWarsService<span class="token punctuation">,</span> useValue<span class="token operator">:</span> mockStarWarsService <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compileComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mockStarWarsService<span class="token punctuation">.</span>getCharacters<span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">returnValue</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      results<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> uid<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> properties<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Luke Skywalker'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">'male'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      total_records<span class="token operator">:</span> <span class="token number">82</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fixture <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span>CharacterListComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    component <span class="token operator">=</span> fixture<span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span>
    fixture<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should load characters and update pagination'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockStarWarsService<span class="token punctuation">.</span>getCharacters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>totalCount<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">82</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Simulate page change</span>
    <span class="token keyword">const</span> paginator <span class="token operator">=</span> fixture<span class="token punctuation">.</span>debugElement<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span>MatPaginator<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> paginatorComponent <span class="token operator">=</span> paginator<span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span>
    paginatorComponent<span class="token punctuation">.</span>pageIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    paginatorComponent<span class="token punctuation">.</span>page<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pageIndex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> length<span class="token operator">:</span> <span class="token number">82</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>mockStarWarsService<span class="token punctuation">.</span>getCharacters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This test verifies that:</p>
<ol>
<li>The component loads characters on initialization</li>
<li>The pagination information is correctly updated</li>
<li>Page changes trigger new API calls with the correct parameters</li>
</ol>
<h2>Cosmic Compiler Summary</h2>
<ul>
<li>We've <strong>transitioned from cards to a MatTable</strong> for a more structured data display</li>
<li>We've <strong>added MatPaginator</strong> to enable navigation through large datasets</li>
<li>We've <strong>updated our DataSource</strong> to handle pagination properly with dynamic page sizes</li>
<li>We've <strong>enhanced our StarWarsService</strong> to accept page and limit parameters</li>
<li>We've <strong>implemented reactive state tracking</strong> with multiple BehaviorSubjects for characters, loading state, count, page, and page size</li>
<li>We've <strong>handled the conversion</strong> between 0-based UI pagination and 1-based API pagination</li>
<li>We've <strong>managed loading states</strong> to provide feedback during page transitions with different spinner placements</li>
<li>We've <strong>added proper error handling</strong> to gracefully handle API failures</li>
<li>We've <strong>implemented proper subscription management</strong> to prevent memory leaks</li>
<li>We've <strong>added data-testid attributes</strong> to improve testability</li>
</ul>
<blockquote>
<p>The Council of Patterns once decreed: &quot;A table without pagination is merely a list with delusions of grandeur.&quot; The Cosmic Compiler, ever the enforcer of good practices, has been known to mysteriously increase build times for applications that ignore this wisdom.</p>
</blockquote>
<p><em>In our next transmission, we'll enhance our table further by adding sorting capabilities. We'll implement sorting for our data, allowing users to organize the Galactic Archives by various attributes like name, height, or birth year. We'll explore both client-side and server-side sorting approaches and discuss the trade-offs. The Ancient Order of Angular teaches that a well-organized archive is the mark of a civilized application.</em></p>
<p><em>Remember that the full source code for this project is available in the Galactic Archives repository. The Council of Patterns recommends studying the implementation details, particularly how we've structured the DataSource class to handle both pagination and upcoming sorting functionality.</em></p>
<p><em>May your tables be paginated, your data sources be clean, and your users never reach the dreaded &quot;page 404&quot;.</em></p>

  </article>
  
  <section>
    <hr>
    
    <div class="series-navigation">
      
      <p>
        <a href="/musings/post-7-datasource-foundation/">← Previous</a>
        
 |         <a href="/musings/galactic-archives-series/">Series Overview</a>
        
 |         <a href="/musings/post-9-adding-sorting/">Next →</a>
      </p>
    </div>
    
    <div class="post-footer">
      <p><a href="/musings/">← Back to all musings</a></p>
      
    </div>
  </section>
</main>

    </article>
  </body>
</html>
